import{j as e,A as Y,m as P}from"./animations-Bhk9jgEx.js";import{r as s}from"./vendor-ChMdqddh.js";import{u as G}from"./index-KmBRAKCn.js";import{B as Q,V as Z,d as ee,e as te,f as ne,g as se,S as re,X as ie,h as ae}from"./ui-CbsdFIk4.js";const oe={},fe=()=>{const{language:c}=G(),[m,y]=s.useState(!1),[h,N]=s.useState(""),[T,C]=s.useState([{id:"1",sender:"bot",text:"Hej! üëã Jag heter Sofia och √§r NetvisionKs AI-agent. Hur kan jag hj√§lpa dig med v√•ra digitala l√∂sningar idag?",timestamp:new Date}]),[z,M]=s.useState(!1),[u,j]=s.useState(!1),[x,U]=s.useState(!1),[E,S]=s.useState(!1),[H,k]=s.useState(null),[R,J]=s.useState(null),d=s.useRef(null),D=s.useRef(null),i=s.useRef(null),I=s.useRef(null),b=s.useRef(""),g=s.useRef(!0),A=s.useRef(!1),v=s.useRef(!1);s.useEffect(()=>{A.current=m},[m]),s.useEffect(()=>{v.current=E},[E]),s.useEffect(()=>{b.current=h},[h]);const $=()=>{var t;(t=D.current)==null||t.scrollIntoView({behavior:"smooth"})};s.useEffect(()=>{$()},[T,z]);const w=s.useCallback(()=>{window.speechSynthesis.cancel(),d.current&&(d.current.pause(),d.current.currentTime=0),S(!1),k(null)},[]),p=s.useCallback(()=>{if(!(!g.current||v.current))try{i.current&&(i.current.start(),j(!0))}catch{}},[]);s.useEffect(()=>{const t=()=>{!u&&g.current&&p()};return window.addEventListener("click",t,{once:!0}),()=>window.removeEventListener("click",t)},[u,p]);const F=()=>{var t;u?(g.current=!1,(t=i.current)==null||t.stop(),j(!1)):(g.current=!0,p())},V=s.useCallback(()=>{const t=window.speechSynthesis.getVoices(),n=c==="sv"?"sv":c==="sq"?"sq":"en",a=t.filter(l=>l.lang.startsWith(n)),r=a.find(l=>l.name.includes("Natural")||l.name.includes("Neural"))||a.find(l=>l.name.includes("Google"))||a[0];r&&J(r)},[c]);s.useEffect(()=>(V(),window.speechSynthesis.onvoiceschanged=V,()=>{window.speechSynthesis.onvoiceschanged=null}),[V]);const q=s.useCallback(async(t,n)=>{var B,O,K;if(x)return;(B=i.current)==null||B.stop(),w();const a=oe,r=(a==null?void 0:a.VITE_ELEVENLABS_API_KEY)||((K=(O=window.process)==null?void 0:O.env)==null?void 0:K.REACT_APP_ELEVENLABS_API_KEY)||"",l=c==="sv"?"9BWtsm6S4pxI5S8p84qf":"21m00Tcm4TbcDqHe8dBC",o=()=>{S(!1),k(null),g.current&&setTimeout(p,200)};if(r)try{S(!0),k(n);const _=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${l}`,{method:"POST",headers:{"Content-Type":"application/json","xi-api-key":r},body:JSON.stringify({text:t,model_id:"eleven_multilingual_v2",voice_settings:{stability:.5,similarity_boost:.75}})});if(!_.ok)throw new Error;const X=await _.blob();d.current||(d.current=new Audio),d.current.src=URL.createObjectURL(X),d.current.onended=o,d.current.play();return}catch{console.error("ElevenLabs failed")}const f=new SpeechSynthesisUtterance(t);f.voice=R||null,R||(f.lang=c==="sv"?"sv-SE":c==="sq"?"sq-AL":"en-US"),f.onstart=()=>{S(!0),k(n)},f.onend=o,window.speechSynthesis.speak(f)},[x,w,c,R,p]),W=t=>{const n=t.toLowerCase();return n.includes("pris")||n.includes("kostnad")||n.includes("offert")?"V√•ra priser √§r skr√§ddarsydda efter varje projekts behov. F√∂r outsourcing erbjuder vi ofta l√∂sningar som √§r 30-50% mer kostnadseffektiva √§n lokala alternativ. Vill du ha en offert? [Kontakta oss via formul√§ret](/contact)!":n.includes("kontakt")||n.includes("mail")||n.includes("telefon")?`Du kan n√• oss via:
üìß info@netvisionks.com
üìû 08-123 45 67
üìç [Hitta oss p√• Sveav√§gen 1, Stockholm](/contact)`:n.includes("jobb")||n.includes("karri√§r")||n.includes("rekrytering")?"Vi s√∂ker alltid efter nya talanger! Just nu letar vi efter Senior React Developers och .NET experter. Kolla in v√•r [Karri√§r-sida](/contact) f√∂r mer info.":n.includes("tj√§nster")||n.includes("erbjuder")?`Vi specialiserar oss p√•:
‚úÖ Staff Augmentation
‚úÖ Skr√§ddarsydd Utveckling
‚úÖ Molnl√∂sningar
‚úÖ Apputveckling`:n.includes("hej")||n.includes("tja")?"Hej d√§r! Kul att du tittar f√∂rbi. Vad kan jag hj√§lpa till med?":"Jag √§r fortfarande under uppl√§rning! üòä Jag kan svara p√• fr√•gor om v√•ra tj√§nster, priser, karri√§r eller kontaktuppgifter."},L=s.useCallback(t=>{const n=t.trim();if(n.length<2)return;w();const a={id:Date.now().toString(),sender:"user",text:n,timestamp:new Date};C(r=>[...r,a]),N(""),b.current="",M(!0),setTimeout(()=>{const r=W(n),l=(Date.now()+1).toString();C(o=>[...o,{id:l,sender:"bot",text:r,timestamp:new Date}]),M(!1),q(r,l)},1500)},[w,q]);return s.useEffect(()=>{const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(t)return i.current||(i.current=new t,i.current.continuous=!0,i.current.interimResults=!0),i.current.onresult=n=>{if(v.current)return;let a="",r="";for(let o=n.resultIndex;o<n.results.length;++o)n.results[o].isFinal?a+=n.results[o][0].transcript:r+=n.results[o][0].transcript;if(!a&&!r)return;if((a+r).toLowerCase().includes("hej sofia")&&!A.current){y(!0);return}A.current&&a&&(N(o=>{const f=o+(o?" ":"")+a;return b.current=f,f}),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{b.current.trim().length>=2&&!v.current&&L(b.current)},2e3))},i.current.onend=()=>{j(!1),g.current&&!v.current&&setTimeout(p,100)},i.current.onerror=n=>{n.error==="not-allowed"&&(g.current=!1,j(!1))},()=>{i.current&&(i.current.onresult=null,i.current.onend=null,i.current.onerror=null)}},[L,p]),s.useEffect(()=>{i.current&&(i.current.lang=c==="sv"?"sv-SE":c==="sq"?"sq-AL":"en-US")},[c]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:m&&e.jsxs(P.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:"fixed bottom-24 right-4 md:right-8 w-[90vw] md:w-[380px] h-[500px] bg-white/80 backdrop-blur-xl border border-white/50 rounded-2xl shadow-2xl z-50 overflow-hidden flex flex-col font-sans",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 p-4 flex justify-between items-center text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(Q,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm",children:"Sofia ‚Äî AI Agent"}),e.jsxs("span",{className:"text-xs text-white/80 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Online"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{E&&w(),U(!x)},className:"p-1.5 hover:bg-white/10 rounded-lg","aria-label":x?"Sl√• p√• ljud":"St√§ng av ljud",children:x?e.jsx(Z,{size:18}):e.jsx(ee,{size:18})}),e.jsx("button",{onClick:()=>y(!1),className:"p-1.5 hover:bg-white/10 rounded-lg","aria-label":"Minimera chatt",children:e.jsx(te,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/50",children:[T.map(t=>e.jsx("div",{className:`flex ${t.sender==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`p-3 rounded-2xl text-sm max-w-[85%] relative ${t.sender==="user"?"bg-orange-600 text-white rounded-tr-none":"bg-white border text-gray-800 rounded-tl-none"}`,children:[t.sender==="bot"?e.jsx("div",{children:t.text.split(/(\[.*?\]\(.*?\))/g).map((n,a)=>{const r=n.match(/\[(.*?)\]\((.*?)\)/);return r?e.jsx("a",{href:r[2],className:"text-orange-600 font-bold hover:underline",children:r[1]},a):n})}):t.text,H===t.id&&e.jsxs("span",{className:"absolute -left-6 top-1/2 -translate-y-1/2 flex gap-0.5",children:[e.jsx("span",{className:"w-1 h-3 bg-orange-500 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1 h-5 bg-orange-500 rounded-full animate-pulse"})]})]})},t.id)),z&&e.jsx("div",{className:"p-3 bg-white border w-max rounded-2xl rounded-tl-none animate-pulse",children:"..."}),e.jsx("div",{ref:D})]}),e.jsx("div",{className:"p-4 bg-white border-t",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),L(h)},className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:h,onChange:t=>N(t.target.value),placeholder:u?"Lyssnar...":"Skriv h√§r...",className:`w-full bg-gray-100 rounded-xl px-4 py-3 pr-10 text-sm outline-none focus:ring-2 focus:ring-orange-500 ${u?"ring-2 ring-orange-400":""}`}),e.jsx("button",{type:"button",onClick:F,className:`absolute right-2 top-1/2 -translate-y-1/2 p-2 ${u?"text-red-500":"text-gray-400"}`,"aria-label":u?"Sluta lyssna":"Starta r√∂stinmatning",children:u?e.jsx(ne,{size:18}):e.jsx(se,{size:18})})]}),e.jsx("button",{type:"submit",disabled:!h.trim(),className:"bg-orange-600 text-white p-3 rounded-xl","aria-label":"Skicka meddelande",children:e.jsx(re,{size:20})})]})})]})}),e.jsx(P.button,{onClick:()=>y(!m),className:"fixed bottom-32 right-6 md:bottom-8 md:right-8 z-50 bg-gradient-to-r from-orange-600 to-red-600 text-white p-4 rounded-full shadow-lg","aria-label":m?"St√§ng AI-chatt":"√ñppna AI-chatt",children:m?e.jsx(ie,{size:28}):e.jsx(ae,{size:28})})]})};export{fe as default};
